---
layout: default
title: Wetter
---

<div class="search">
  <input id="search" type="text" placeholder="loading..." />
  <img src="search.svg" />
</div>
<div class="liste" id="search-liste"></div>

<script>
  var search_input = document.getElementById("search");
  var search_liste_div = document.getElementById("search-liste");

  search_input.addEventListener("input", (e) => {
    show_search_results();
  });
  search_input.addEventListener("keyup", ({ key }) => {
    if (key === "Enter") {
      console.log("Enter");
    }
  });

  function show_search_results() {
    let input = search_input.value;
    if (!input || !locations_data) return;

    const results = fuzzysort.go(input, locations_data, {
      threshold: -20000,
      limit: 5,
      allowTypo: true,
      key: "name",
    });

    search_liste_div.textContent = "";
    results.forEach((result) => {
      let location_a = document.createElement("a");
      location_a.innerHTML = fuzzysort.highlight(result);
      location_a.href = "/show?location=" + result.obj.name;
      search_liste_div.appendChild(location_a);
      if (result.obj.meteoblue_src)
        search_liste_div.appendChild(document.createTextNode("*"));
      search_liste_div.appendChild(document.createElement("br"));
    });
  }

  function show_lastvisited() {
    let lastvisited;
    try {
      lastvisited = JSON.parse(localStorage.getItem("lastvisited")) || [];
    } catch (e) {
      lastvisited = [];
    }

    search_liste_div.textContent = "";
    search_liste_div.innerHTML =
      '<a href="/show?gps"><b>aktueller Standort</b></a><br>';
    lastvisited.forEach((element) => {
      let location_a = document.createElement("a");
      location_a.innerText = element.name;
      location_a.href =
        "/show?location=" +
        (element.location ? element.location : element.name);
      search_liste_div.appendChild(location_a);
      search_liste_div.appendChild(document.createElement("br"));
    });
  }

  show_lastvisited();
  window.addEventListener("pageshow", (event) => {
    if (
      event.persisted ||
      (typeof window.performance != "undefined" &&
        window.performance.navigation.type === 2)
    )
      show_lastvisited();
  });
  var locations_data;

  fetch("/locations.json")
    .then((response) => {
      if (response.ok) {
        return Promise.resolve(response);
      } else {
        return Promise.reject(new Error(response.statusText));
      }
    })
    .then((response) => {
      return response.json();
    })
    .then((data) => {
      locations_data = data;
      search_input.setAttribute("placeholder", "Suche");
      show_search_results();
    })
    .catch((error) => {
      console.log("Request failed", error);
    });
</script>
